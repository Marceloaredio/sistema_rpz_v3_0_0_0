<!-- Componente de Autocomplete -->
<style>
.autocomplete-wrapper {
    position: relative;
    width: 100%;
}

.autocomplete-input {
    width: 100%;
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s;
}

.autocomplete-input:focus {
    border-color: #2C3E50;
}

.autocomplete-list {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    max-height: 200px;
    overflow-y: auto;
    background: white;
    border: 1px solid #ddd;
    border-radius: 0 0 4px 4px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    z-index: 1000;
    display: none;
}

.autocomplete-item {
    padding: 8px 12px;
    cursor: pointer;
    transition: background-color 0.2s;
}

.autocomplete-item:hover,
.autocomplete-item.selected {
    background-color: #f8f9fa;
}

.autocomplete-item.active {
    background-color: #e9ecef;
}

/* Estilização da barra de rolagem */
.autocomplete-list::-webkit-scrollbar {
    width: 8px;
}

.autocomplete-list::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
}

.autocomplete-list::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 4px;
}

.autocomplete-list::-webkit-scrollbar-thumb:hover {
    background: #555;
}
</style>

<script>
function initAutocomplete(inputId, options) {
    const input = document.getElementById(inputId);
    if (!input) return null;

    // Criar wrapper e lista
    const wrapper = document.createElement('div');
    wrapper.className = 'autocomplete-wrapper';
    input.parentNode.insertBefore(wrapper, input);
    wrapper.appendChild(input);

    const list = document.createElement('div');
    list.className = 'autocomplete-list';
    wrapper.appendChild(list);

    // Configurações padrão
    const config = {
        data: [],
        minChars: 1,
        maxItems: 10,
        placeholder: '',
        onSelect: () => {},
        ...options
    };

    // Definir placeholder
    input.placeholder = config.placeholder;

    let selectedIndex = -1;
    let items = [];

    // Função para ordenar os itens alfabeticamente
    function sortItems(items) {
        return items.sort((a, b) => a.label.localeCompare(b.label, 'pt-BR'));
    }

    // Função para filtrar e exibir sugestões
    function showSuggestions(query) {
        query = query.toLowerCase();
        
        // Filtrar e ordenar itens
        items = sortItems(config.data.filter(item => 
            item.label.toLowerCase().includes(query)
        )).slice(0, config.maxItems);

        // Limpar e preencher a lista
        list.innerHTML = '';
        items.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'autocomplete-item';
            div.textContent = item.label;
            
            div.addEventListener('click', () => selectItem(index));
            div.addEventListener('mouseover', () => {
                selectedIndex = index;
                updateSelection();
            });
            
            list.appendChild(div);
        });

        // Mostrar ou esconder a lista
        list.style.display = items.length > 0 ? 'block' : 'none';
        selectedIndex = -1;
    }

    // Função para selecionar um item
    function selectItem(index) {
        if (index >= 0 && index < items.length) {
            const item = items[index];
            input.value = item.label;
            list.style.display = 'none';
            config.onSelect(item);
        }
    }

    // Função para atualizar a seleção visual
    function updateSelection() {
        const elements = list.getElementsByClassName('autocomplete-item');
        for (let i = 0; i < elements.length; i++) {
            elements[i].classList.remove('selected');
        }
        if (selectedIndex >= 0 && selectedIndex < elements.length) {
            elements[selectedIndex].classList.add('selected');
            elements[selectedIndex].scrollIntoView({ block: 'nearest' });
        }
    }

    // Event listeners
    input.addEventListener('input', () => {
        const query = input.value.trim();
        if (query.length >= config.minChars) {
            showSuggestions(query);
        } else {
            list.style.display = 'none';
        }
    });

    // input.addEventListener('focus', () => {
    //     if (input.value.trim().length >= config.minChars) {
    //         showSuggestions(input.value.trim());
    //     }
    // });

    input.addEventListener('keydown', (e) => {
        const visible = list.style.display === 'block';
        
        switch (e.key) {
            case 'ArrowDown':
                if (visible) {
                    selectedIndex = Math.min(selectedIndex + 1, items.length - 1);
                    updateSelection();
                    e.preventDefault();
                }
                break;
            
            case 'ArrowUp':
                if (visible) {
                    selectedIndex = Math.max(selectedIndex - 1, 0);
                    updateSelection();
                    e.preventDefault();
                }
                break;
            
            case 'Enter':
                if (visible && selectedIndex >= 0) {
                    selectItem(selectedIndex);
                    e.preventDefault();
                }
                break;
            
            case 'Escape':
                list.style.display = 'none';
                selectedIndex = -1;
                break;
        }
    });

    // Fechar a lista quando clicar fora
    document.addEventListener('click', (e) => {
        if (!wrapper.contains(e.target)) {
            list.style.display = 'none';
        }
    });

    return {
        setValue: (value) => {
            input.value = value;
        },
        getValue: () => input.value,
        clear: () => {
            input.value = '';
            list.style.display = 'none';
        }
    };
}
</script> 